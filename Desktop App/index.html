<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Camera Monitor</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-video"></i>
                    <h2>Traffic Monitor</h2>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Search Section -->
                <div class="search-section">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Tìm kiếm camera theo mã số, địa điểm, đường phố...">
                        <button id="clearSearch" class="clear-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="filter-group">
                        <h3><i class="fas fa-map-marker-alt"></i> Theo Thành Phố</h3>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="radio" name="city" value="all" checked>
                                <span>Tất cả thành phố</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="city" value="hanoi">
                                <span>Hà Nội</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="city" value="hcmc">
                                <span>TP. Hồ Chí Minh</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="city" value="danang">
                                <span>Đà Nẵng</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="city" value="haiphong">
                                <span>Hải Phòng</span>
                            </label>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h3><i class="fas fa-building"></i> Theo Quận/Huyện</h3>
                        <div class="filter-options" id="districtFilters">
                            <label class="filter-option">
                                <input type="radio" name="district" value="all" checked>
                                <span>Tất cả quận/huyện</span>
                            </label>
                            <!-- District options will be populated dynamically -->
                        </div>
                    </div>

                    <div class="filter-group">
                        <h3><i class="fas fa-road"></i> Theo Loại Ngã Tư</h3>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="radio" name="intersection" value="all" checked>
                                <span>Tất cả loại</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="intersection" value="major">
                                <span>Ngã tư lớn</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="intersection" value="medium">
                                <span>Ngã tư trung bình</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="intersection" value="minor">
                                <span>Ngã tư nhỏ</span>
                            </label>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h3><i class="fas fa-car"></i> Loại Phương Tiện</h3>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" id="filterMotorcycle" checked>
                                <span>Xe máy</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" id="filterCar" checked>
                                <span>Ô tô</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" id="filterTruck" checked>
                                <span>Xe tải</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" id="filterBus" checked>
                                <span>Xe buýt</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Navigation Tabs -->
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-tab="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Bảng điều khiển</span>
                    </button>
                    <button class="nav-tab" data-tab="history">
                        <i class="fas fa-history"></i>
                        <span>Lịch sử</span>
                    </button>
                    <button class="nav-tab" data-tab="alerts">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Cảnh báo</span>
                    </button>
                    <button class="nav-tab" data-tab="settings">
                        <i class="fas fa-cog"></i>
                        <span>Cài đặt</span>
                    </button>
                </nav>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <h3><i class="fas fa-chart-line"></i> Tổng Quan Hệ Thống</h3>
                    <div class="stat-item">
                        <i class="fas fa-video"></i>
                        <div>
                            <span class="stat-label">Camera hoạt động</span>
                            <span class="stat-value" id="activeCameras">4</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-car"></i>
                        <div>
                            <span class="stat-label">Tổng phương tiện</span>
                            <span class="stat-value" id="totalVehicles">0</span>
                        </div>
                    </div>
                    <div class="stat-item alert" id="alertStat">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <span class="stat-label">Cảnh báo hiện tại</span>
                            <span class="stat-value" id="activeAlerts">0</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <span class="stat-label">Thời gian cập nhật</span>
                            <span class="stat-value" id="updateTime">--:--</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <h1>Hệ Thống Giám Sát Giao Thông</h1>
                    <div class="breadcrumb">
                        <span>Trang chủ</span>
                        <i class="fas fa-chevron-right"></i>
                        <span id="currentView">Bảng điều khiển</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="status-indicator">
                        <i class="fas fa-circle" id="connectionStatus"></i>
                        <span id="connectionText">Đã kết nối</span>
                    </div>
                    <div class="last-update">
                        Cập nhật lần cuối: <span id="lastUpdate">--:--:--</span>
                    </div>
                    <button class="btn btn-primary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        Làm mới
                    </button>
                    <button class="btn btn-secondary" id="exportBtn">
                        <i class="fas fa-download"></i>
                        Xuất dữ liệu
                    </button>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboardTab">
                    <div class="dashboard-grid" id="dashboardGrid">
                        <!-- Camera cards will be dynamically generated here -->
                    </div>
                </div>

                <!-- History Tab -->
                <div class="tab-content" id="historyTab">
                    <div class="history-controls">
                        <select id="historyTimeRange">
                            <option value="1h">Last Hour</option>
                            <option value="24h" selected>Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                        </select>
                        <select id="historyCameraSelect">
                            <option value="all">All Cameras</option>
                        </select>
                    </div>
                    <div class="history-chart-container">
                        <canvas id="historyChart"></canvas>
                    </div>
                </div>

                <!-- Alerts Tab -->
                <div class="tab-content" id="alertsTab">
                    <div class="alerts-container">
                        <div class="alerts-header">
                            <h3>Recent Alerts</h3>
                            <button class="btn btn-secondary" id="clearAllAlerts">
                                <i class="fas fa-trash"></i>
                                Clear All
                            </button>
                        </div>
                        <div class="alerts-list" id="alertsList">
                            <!-- Alerts will be dynamically generated here -->
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settingsTab">
                    <div class="settings-container">
                        <div class="settings-section">
                            <h3>Display Settings</h3>
                            <div class="setting-item">
                                <label for="refreshRate">Refresh Rate (seconds)</label>
                                <select id="refreshRate">
                                    <option value="5">5 seconds</option>
                                    <option value="10" selected>10 seconds</option>
                                    <option value="30">30 seconds</option>
                                    <option value="60">1 minute</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="alertThreshold">High Traffic Alert Threshold</label>
                                <input type="number" id="alertThreshold" value="100" min="50" max="500">
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="soundAlerts" checked>
                                    <span>Enable Sound Alerts</span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoRefresh" checked>
                                    <span>Auto Refresh Data</span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Camera Settings</h3>
                            <div class="setting-item">
                                <label for="videoQuality">Video Quality</label>
                                <select id="videoQuality">
                                    <option value="low">Low (480p)</option>
                                    <option value="medium" selected>Medium (720p)</option>
                                    <option value="high">High (1080p)</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showTimestamp" checked>
                                    <span>Show Timestamp on Video</span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Data & Privacy</h3>
                            <div class="setting-item">
                                <button class="btn btn-secondary" id="clearDataBtn">
                                    <i class="fas fa-trash"></i>
                                    Clear Local Data
                                </button>
                            </div>
                            <div class="setting-item">
                                <button class="btn btn-primary" id="saveSettingsBtn">
                                    <i class="fas fa-save"></i>
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading camera data...</p>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Full Screen Modal -->
    <div class="modal-overlay" id="fullscreenModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalCameraTitle">Camera Details</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="fullscreen-camera">
                    <img id="fullscreenImage" src="" alt="Camera Feed">
                </div>
                <div class="fullscreen-metrics" id="fullscreenMetrics">
                    <!-- Detailed metrics will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Management Modal -->
    <div class="modal-overlay" id="cameraModal">
        <div class="modal-content modal-camera-management">
            <div class="modal-header">
                <h3 id="cameraModalTitle">Thêm Camera Mới</h3>
                <button class="modal-close" id="cameraModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="cameraForm" class="camera-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cameraName">Tên Camera <span class="required">*</span></label>
                            <input type="text" id="cameraName" name="name" required placeholder="VD: Ngã tư Hàng Xanh">
                        </div>
                        <div class="form-group">
                            <label for="cameraLocation">Địa chỉ <span class="required">*</span></label>
                            <input type="text" id="cameraLocation" name="location" required placeholder="VD: Đường Điện Biên Phủ - Xô Viết Nghệ Tĩnh">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cameraCity">Thành phố <span class="required">*</span></label>
                            <select id="cameraCity" name="city" required>
                                <option value="">Chọn thành phố</option>
                                <option value="hanoi">Hà Nội</option>
                                <option value="hcm">Hồ Chí Minh</option>
                                <option value="danang">Đà Nẵng</option>
                                <option value="haiphong">Hải Phòng</option>
                                <option value="cantho">Cần Thơ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cameraDistrict">Quận/Huyện <span class="required">*</span></label>
                            <input type="text" id="cameraDistrict" name="district" required placeholder="VD: Quận 1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cameraIntersection">Loại giao lộ</label>
                            <select id="cameraIntersection" name="intersection">
                                <option value="major">Giao lộ chính</option>
                                <option value="medium">Giao lộ phụ</option>
                                <option value="minor">Đường nhỏ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cameraLines">Số làn đường</label>
                            <input type="number" id="cameraLines" name="lines" min="1" max="10" value="3" placeholder="3">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cameraVideoUrl">URL Video/Stream</label>
                        <div class="url-input-group">
                            <input type="url" id="cameraVideoUrl" name="videoUrl" placeholder="https://example.com/stream.m3u8 hoặc rtsp://...">
                            <button type="button" id="testStreamBtn" class="btn btn-secondary">
                                <i class="fas fa-play"></i>
                                Test
                            </button>
                        </div>
                        <div class="stream-test-result" id="streamTestResult"></div>
                    </div>

                    <div class="form-group">
                        <label for="cameraStreamType">Loại Stream</label>
                        <select id="cameraStreamType" name="streamType">
                            <option value="http">HTTP/HTTPS</option>
                            <option value="hls">HLS (m3u8)</option>
                            <option value="rtsp">RTSP</option>
                            <option value="websocket">WebSocket</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelCameraBtn">
                            <i class="fas fa-times"></i>
                            Hủy
                        </button>
                        <button type="submit" class="btn btn-primary" id="saveCameraBtn">
                            <i class="fas fa-save"></i>
                            <span id="saveCameraBtnText">Thêm Camera</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Camera Management Actions -->
    <div class="camera-management-actions">
        <button class="btn btn-primary camera-action-btn" id="addCameraBtn" title="Thêm camera mới">
            <i class="fas fa-plus"></i>
        </button>
        <button class="btn btn-success camera-action-btn" id="saveDatabaseBtn" title="Lưu cơ sở dữ liệu" style="display: none;">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="renderer.js"></script>
</body>
</html>
